"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();!function(t){var e=[],s=function(t){for(var e=void 0,s=1;s<arguments.length;s++)e=arguments[s],Array.prototype.push.apply(t,e)},i=function(){function t(e){var s=arguments.length<=1||void 0===arguments[1]?0:arguments[1];_classCallCheck(this,t),this.objects=[],this.nodes=[],this.level=s,this.bounds=e,this.MAX_OBJECTS=10,this.MAX_LEVELS=5}return _createClass(t,[{key:"clear",value:function(){for(this.objects.length=0;this.nodes.length;){var t=this.nodes.shift();t.clear()}}},{key:"split",value:function(){var e=this.bounds.x,s=this.bounds.y,i=this.bounds.sWidth,r=this.bounds.sHeight;this.nodes.push(new t(new h(this.bounds.cX,s,i,r),this.level+1),new t(new h(e,s,i,r),this.level+1),new t(new h(e,this.bounds.cY,i,r),this.level+1),new t(new h(this.bounds.cX,this.bounds.cY,i,r),this.level+1))}},{key:"getIndex",value:function(t,e){var s=t.y+t.h<=this.bounds.cY,i=t.y>=this.bounds.cY,h=t.x+t.w<=this.bounds.cX,r=t.x>=this.bounds.cX;if(e&&(Math.abs(t.cX-this.bounds.cX)+t.sWidth>this.bounds.sWidth||Math.abs(t.cY-this.bounds.cY)+t.sHeight>this.bounds.sHeight))return-1;if(s){if(r)return 0;if(h)return 1}else if(i){if(h)return 2;if(r)return 3}return-1}},{key:"insert",value:function(t){if(this.nodes.length){var e=this.getIndex(t);if(-1!==e)return void this.nodes[e].insert(t)}if(this.objects.push(t),!this.nodes.length&&this.objects.length>this.MAX_OBJECTS&&this.level<this.MAX_LEVELS){this.split();for(var s=this.objects.length-1;s>=0;s--){var i=this.getIndex(this.objects[s]);-1!==i&&this.nodes[i].insert(this.objects.splice(s,1)[0])}}}},{key:"refresh",value:function(t){t=t||this;for(var e=this.objects.length-1;e>=0;e--){var s=this.getIndex(this.objects[e],!0);-1===s?this!==t&&t.insert(this.objects.splice(e,1)[0]):this.nodes.length&&this.nodes[s].insert(this.objects.splice(e,1)[0])}for(var i=0,h=this.nodes.length;h>i;i++)this.nodes[i].refresh(t)}},{key:"retrieve",value:function(t){var i=e;if(0===this.level&&(i.length=0),s(i,this.objects),this.nodes.length){var h=this.getIndex(t);if(-1!==h)this.nodes[h].retrieve(t);else for(var r=t.carve(this.bounds.cX,this.bounds.cY),n=r.length-1;n>=0;n--)h=this.getIndex(r[n]),this.nodes[h].retrieve(t)}return i}}]),t}(),h=function(){function t(e,s,i,h){var r=arguments.length<=4||void 0===arguments[4]?{0:20,1:20}:arguments[4];_classCallCheck(this,t),this.speedArr=r,this.nextSpeedArr={0:this.speedArr[0],1:this.speedArr[1]},this.resize(i,h),this.moveTo(e,s)}return _createClass(t,[{key:"moveTo",value:function(t,e){this.x=t,this.y=e,this.cX=t+this.sWidth,this.cY=e+this.sHeight}},{key:"resize",value:function(t,e){this.w=t,this.h=e,this.sWidth=t/2,this.sHeight=e/2}},{key:"draw",value:function(t){t.save(),t.beginPath(),t.rect(this.x,this.y,this.w,this.h),t.closePath(),t.restore()}},{key:"run",value:function(){this.speedArr[0]=this.nextSpeedArr[0],this.speedArr[1]=this.nextSpeedArr[1],this.moveTo(this.x+.016*this.speedArr[0],this.y+.016*this.speedArr[1])}},{key:"copy",value:function(t){this.resize(t.w,t.h),this.moveTo(t.x,t.y),this.nextSpeedArr[0]=t.speedArr[0],this.nextSpeedArr[1]=t.speedArr[1]}},{key:"init",value:function(t,e,s,i,h){this.resize(s,i),this.moveTo(t,e)}},{key:"collide",value:function(t,e){var s=n[0],i=n[1],h=void 0,r=void 0,o=void 0,c=void 0,a=void 0,u=void 0,l=void 0;if(e)Math.abs(this.cX-t.cX)+this.sWidth>t.sWidth&&(this.nextSpeedArr[0]=-(this.nextSpeedArr[0]||this.speedArr[0]),this.moveTo(this.cX>t.cX?t.x+t.w-this.w:t.x,this.y)),Math.abs(this.cY-t.cY)+this.sHeight>t.sHeight&&(this.nextSpeedArr[1]=-(this.nextSpeedArr[1]||this.speedArr[1]),this.moveTo(this.x,this.cY>t.cY?t.y+t.h-this.h:t.y));else{for(s.copy(this),i.copy(t),h=s.sWidth+i.sWidth,r=s.sHeight+i.sHeight,o=h-Math.abs(s.cX-i.cX),c=r-Math.abs(s.cY-i.cY);o>0&&c>0;)s.run(-16),i.run(-16),o=h-Math.abs(s.cX-i.cX),c=r-Math.abs(s.cY-i.cY);a=0>=o,u=0>=c,a&&(l=this.cX>t.cX?1:-1,this.nextSpeedArr[0]=l*(Math.abs(this.nextSpeedArr[0])+Math.abs(t.speedArr[0]))/2),u&&(l=s.cY>i.cY?1:-1,this.nextSpeedArr[1]=l*(Math.abs(this.nextSpeedArr[1])+Math.abs(t.speedArr[1]))/2)}}},{key:"carve",value:function(e,s){var i=[],h=[],r=e-this.x,n=s-this.y,o=r>0&&r<this.w,c=n>0&&n<this.h;if(o&&c)for(h=this.carve(e,this.y);h.length;)i=i.concat(h.shift().carve(this.x,s));else o?i.push(new t(this.x,this.y,r,this.h),new t(e,this.y,this.w-r,this.h)):c&&i.push(new t(this.x,this.y,this.w,n),new t(this.x,s,this.w,this.h-n));return i}},{key:"isApproach",value:function(t,e){var s=n[0],i=n[1];return s.copy(t),i.copy(e),s.run(),i.run(),+(Math.pow(t.cX-e.cX,2)-Math.pow(s.cX-i.cX,2)+Math.pow(t.cY-e.cY,2)-Math.pow(s.cY-i.cY,2)).toFixed(6)>0?!0:!1}},{key:"isCollide",value:function(t,e){Math.abs(t.cX-e.cX)<t.sWidth+e.sWidth&&Math.abs(t.cY-e.cY)<t.sHeight+e.sHeight&&this.isApproach(t,e)&&(t.collide(e),e.collide(t))}}]),t}(),r=function(t){function e(t,s,i,h){var r=arguments.length<=4||void 0===arguments[4]?{0:10,1:10}:arguments[4],n=arguments[5],o=arguments[6],c=arguments[7];_classCallCheck(this,e);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,s,i,h,r));return a.x=t,a.y=s,a.radius=.5*i,a.width=i,a.height=h,a.speedArr=r,a.nextSpeedArr={0:a.speedArr[0],1:a.speedArr[1]},a.linkCount=n,a.dotColorFuc=o,a.lineColorFuc=c,a.dotColor="#ccc",a.lineColor="#ccc",a.linkingCount=0,a.updateColor(),a}return _inherits(e,t),_createClass(e,[{key:"updateColor",value:function(t,e){this.dotColor=this.dotColorFuc(this,t,e),this.lineColor=this.lineColorFuc(this,t,e)}},{key:"draw",value:function(t){t.fillStyle=this.dotColor,t.save(),t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI,!0),t.fill(),t.restore(),this.linkingCount=0}},{key:"willOut",value:function(t,e){(this.x+this.speedArr[0]>t||this.x+this.speedArr[0]<0)&&(this.speedArr[0]=-this.speedArr[0]),(this.y+this.speedArr[1]>e||this.y+this.speedArr[1]<1)&&(this.speedArr[1]=-this.speedArr[1])}},{key:"linkWith",value:function(t,e){e.strokeStyle=this.lineColor,e.lineWidth=.4,e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(t.x,t.y),e.stroke(),e.closePath(),e.save(),t.linkingCount++}},{key:"canLink",value:function(t,e){var s=this;t.forEach(function(t){t.linkingCount<t.linkCount&&s.linkWith(t,e)})}},{key:"distance",value:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)<Math.pow(this.radius+t.radius,2)}},{key:"isCollide",value:function(t,e){t.distance(e)&&this.isApproach(t,e)&&(t.collide(e),e.collide(t))}}]),e}(h),n=[];n.push(new h(0,0,0,0),new h(0,0,0,0));var o=window.innerWidth,c=window.innerHeight-10,a=function(t,e,s){return"rgb("+Math.floor(255*(1-t.x/e))+", "+Math.floor(255*(1-t.y/s))+","+Math.floor(255*(t.speedArr[0]/100))+")"},u=function(t){return Math.random()*t*(10*Math.random()>5?-1:1)},l=function(){function t(e){var s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,t),this.speed=s.speed||30,this.vxFuc=s.vxFuc||u,this.vyFuc=s.vyFuc||u,this.dotColorFuc=s.dotColorFuc||a,this.lineColorFuc=s.lineColorFuc||a,this.count=s.count||32,this.linkCount=s.linkCount||4,this.screenWidth=s.screenWidth||o,this.screenHeight=s.screenHeight||c,this.dotArr=[],this.tree,this.setCanvas(e),this.init(),this.loop()}return _createClass(t,[{key:"setCanvas",value:function(t){return t?(this.canvas=t,t.height=this.screenHeight,t.width=this.screenWidth,t.setAttribute("style","height: "+this.screenHeight+"px; width: "+this.screenWidth+"px"),void(this.cxt=this.canvas.getContext("2d"))):console.error("canvas is must be requried")}},{key:"init",value:function(){this.dotArr.length=0,this.tree=new i(new h(0,0,this.screenWidth,this.screenHeight));for(var t=0;t<this.count;t++){var e=new r(Math.floor(Math.random()*(this.screenWidth-20)),Math.floor(Math.random()*(this.screenHeight-20)),20*Math.random()+5,20*Math.random()+5,{0:this.vxFuc(this.speed),1:this.vyFuc(this.speed)},this.linkCount,this.dotColorFuc,this.lineColorFuc);this.dotArr.push(e),this.tree.insert(e)}}},{key:"draw",value:function(){var t=[];this.cxt.clearRect(0,0,this.screenWidth,this.screenHeight),this.tree.refresh();for(var e=0,s=this.dotArr.length;s>e;e++){t=this.tree.retrieve(this.dotArr[e]),this.dotArr[e].canLink(t,this.cxt);for(var i=0;i<t.length;i++)this.dotArr[e].isCollide(this.dotArr[e],t[i]);this.dotArr[e].collide(new h(0,0,this.screenWidth,this.screenHeight),!0)}for(var r=0,n=this.dotArr.length;n>r;r++)this.dotArr[r].run(),this.dotArr[r].updateColor(this.screenWidth,this.screenHeight),this.dotArr[r].draw(this.cxt);requestAnimationFrame(this.draw.bind(this))}},{key:"loop",value:function(){requestAnimationFrame(this.draw.bind(this))}}]),t}();t.Qarticles=l}(window);